# ИИ-агент CLI

CLI-приложение для работы с ИИ-агентом, реализованное с соблюдением принципов SOLID и Clean Architecture.

## Возможности

- **RAG-поиск**: Семантический поиск по документации проекта (.md файлы)
- **Git инструменты**: Работа с git-репозиторием через набор инструментов
- **Интерактивный CLI**: Удобный интерфейс командной строки
- **Команда /help**: Получение помощи по проекту с использованием RAG

## Архитектура

Проект следует принципам Clean Architecture:

```
project/
├── domain/              # Бизнес-логика, сущности, интерфейсы
│   ├── entities/       # Бизнес-сущности
│   ├── interfaces/     # Интерфейсы репозиториев и сервисов
│   └── use_cases/      # Сценарии использования
├── infrastructure/     # Внешние зависимости, реализации
│   ├── llm/           # Реализации LLM (VKAI, Ollama)
│   ├── tools/         # Реализации инструментов
│   ├── rag/           # RAG система
│   └── config/        # Конфигурация
├── application/        # Слой приложения
│   ├── cli/           # CLI интерфейс
│   ├── commands/      # Команды (/help, /search и т.д.)
│   └── services/      # Сервисы приложения
└── main.py            # Точка входа
```

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd mail-ads-ai
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Настройте Ollama (для эмбеддингов и локальной генерации):
```bash
# Установите Ollama с https://ollama.ai
# Запустите сервер:
ollama serve

# Скачайте модель (опционально, для генерации):
ollama pull llama2
```

5. Создайте файл конфигурации:
```bash
cp local.properties local.properties
```

6. Отредактируйте `local.properties` и укажите:
   - API ключ VK AI (если используете VK AI)
   - Настройки Ollama
   - Пути для RAG системы
   - Рабочую директорию проекта (по умолчанию текущая директория)

## Использование

Запустите приложение:
```bash
python main.py
```

### Команды

- `/help [запрос]` - получить помощь по проекту
- `/search [запрос]` - поиск по документации
- `/exit` или `/quit` - выход из приложения

### Примеры

```
Вы: /help Как работает RAG система?
Агент: [Отвечает на основе найденной документации]

Вы: Покажи структуру проекта
Агент: [Использует git инструменты для получения структуры]

Вы: Какие файлы изменены?
Агент: [Использует git_current_changes инструмент]
```

## Инструменты агента

Агент имеет доступ к следующим инструментам:

### RAG инструменты
- `rag_search` - семантический поиск по документации проекта. Агент использует этот инструмент автоматически, когда нужно найти информацию в документации, README файлах, или когда пользователь спрашивает о проекте.

### Git инструменты
- `git_search_file` - поиск файла по названию
- `git_list_files` - список файлов в директории
- `git_read_file` - чтение содержимого файла
- `git_current_branch` - текущая ветка
- `git_current_changes` - список измененных файлов
- `git_diff` - diff для файла или коммита
- `git_log` - история коммитов
- `git_file_history` - история изменений файла

**Важно:** Агент сам решает, когда использовать каждый инструмент. RAG поиск не выполняется автоматически при каждом запросе, а только когда агент считает это необходимым.

## RAG система

RAG система автоматически индексирует все `.md` файлы в проекте при первом запуске. 
Используется ChromaDB для хранения векторов и Sentence Transformers для генерации эмбеддингов.

## Конфигурация

Все настройки хранятся в `local.properties`:

```properties
# API Keys
vkai.api_key=your_api_key_here
vkai.base_url=https://llm-proxy.vkteam.ru
vkai.model=deepseek-chat

# Ollama Configuration
ollama.base_url=http://localhost:11434
ollama.model=llama2

# RAG Configuration
rag.embedding_model=all-minilm-l6-v2
rag.vector_db_path=./data/vector_db
rag.index_path=./data/index

# Application Settings
app.log_level=INFO
app.data_dir=./data
app.work_dir=.
```

### Изменение рабочей директории

По умолчанию агент работает с текущей директорией (где запущен `main.py`). Чтобы изменить рабочую директорию, укажите путь в `local.properties`:

```properties
# Абсолютный путь
app.work_dir=/path/to/your/project

# Или относительный путь
app.work_dir=../other-project
```

Рабочая директория используется для:
- Индексации `.md` файлов в RAG системе
- Работы всех Git инструментов (поиск файлов, чтение, diff и т.д.)

**Важно:** Убедитесь, что указанная директория является git-репозиторием, если вы планируете использовать Git инструменты.

## Принципы разработки

Проект следует принципам:

- **SOLID**: Single Responsibility, Open/Closed, Liskov Substitution, Interface Segregation, Dependency Inversion
- **Clean Architecture**: Разделение на слои, зависимости направлены внутрь
- **Type Hints**: Полная типизация кода
- **Error Handling**: Обработка ошибок с кастомными исключениями
- **Logging**: Структурированное логирование

## Разработка

### Структура проекта

- `domain/` - бизнес-логика без внешних зависимостей
- `infrastructure/` - реализации интерфейсов из domain
- `application/` - слой приложения, координирует работу компонентов

### Добавление нового инструмента

1. Создайте класс, наследующийся от `BaseTool` в `infrastructure/tools/`
2. Реализуйте методы `name`, `description`, `parameters`, `execute`
3. Зарегистрируйте инструмент в `main.py`

### Добавление нового LLM провайдера

1. Создайте класс, наследующийся от `BaseLLM` в `infrastructure/llm/`
2. Реализуйте методы `_send_request` и `generate_embeddings`
3. Добавьте настройки в `Settings`

## Лицензия

[Укажите лицензию]
