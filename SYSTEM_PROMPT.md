# Системный промпт для ИИ-агента

## Общее описание проекта

Ты работаешь над проектом ИИ-агента, который представляет собой CLI-приложение. Проект должен быть реализован с соблюдением принципов SOLID и Clean Architecture.

## Архитектура проекта

### Абстрактные сущности

#### 1. Нейросеть (LLM)

Необходимо создать абстрактный базовый класс для работы с нейросетями и конкретные реализации:

- **Базовый класс `LLM`** (или `BaseLLM`):
  - Абстрактные методы для отправки запросов
  - Абстрактные методы для обработки ответов
  - Общая логика работы с нейросетями

- **Конкретная реализация `VKAI`**:
  - Реализация интерфейса базового класса
  - Специфичная логика для работы с VK AI API
  - Обработка ошибок и ретраи

#### 2. Инструменты для ИИ (Tools)

Создать систему инструментов для расширения возможностей ИИ-агента:

- **Базовый класс `Tool`**:
  - `name`: название инструмента
  - `description`: описание функциональности
  - `parameters`: схема параметров для вызова (JSON Schema)
  - `execute()`: метод выполнения инструмента
  - `result`: результат выполнения

- Инструменты должны поддерживать взаимодействие с MCP-серверами
- Каждый инструмент должен быть самодостаточной единицей функциональности

## Функциональные требования

### 1. RAG-поиск

Реализовать RAG (Retrieval-Augmented Generation) систему для поиска по документации:

- Использовать локальную модель **Ollama** для эмбеддингов и генерации
- Индексировать все `.md` файлы проекта
- Выполнять семантический поиск по документации
- Интегрировать результаты поиска в контекст для ИИ-агента

**Компоненты RAG-системы:**
- Векторная база данных для хранения эмбеддингов
- Индексатор для обработки md-файлов
- Поисковый модуль для семантического поиска
- Генератор контекста на основе найденных документов

### 2. CLI-приложение

Приложение должно работать как интерактивная командная строка:

- Поддержка команд с префиксом `/` (например, `/help`, `/search`)
- Интерактивный режим работы
- Обработка пользовательских запросов через ИИ-агента
- Вывод результатов в читаемом формате

### 3. Команда /help

Реализовать специальную команду `/help`, которая:

- Отвечает на вопросы о проекте
- Подсказывает фрагменты кода из репозитория
- Объясняет правила стиля кодирования
- Использует RAG-поиск для поиска релевантной документации
- Может анализировать структуру проекта

### 4. Инструменты для работы с Git

Создать набор инструментов (Tools) для взаимодействия с локальным git-репозиторием:

- **`git_search_file`**: поиск файла по названию в репозитории
- **`git_list_files`**: получение списка файлов в директории/репозитории
- **`git_read_file`**: чтение содержимого файла
- **`git_current_branch`**: получение текущей ветки
- **`git_current_changes`**: получение списка измененных файлов (git status)
- **`git_diff`**: получение diff для файла или коммита
- **`git_log`**: получение истории коммитов
- **`git_file_history`**: история изменений конкретного файла

Каждый инструмент должен быть реализован как отдельный класс, наследующийся от `Tool`.

## Конфигурация и переменные окружения

### Локальные переменные

Все локальные переменные (API ключи, настройки подключений, пути и т.д.) должны храниться в файле `local.properties`, который:

- Игнорируется git (добавлен в `.gitignore`)
- Содержит все чувствительные данные
- Имеет пример файла `local.properties.example` с шаблоном структуры
- Используется для загрузки конфигурации при старте приложения

**Формат `local.properties`:**
```properties
# API Keys
vkai.api_key=your_api_key_here
vkai.base_url=https://api.vk.ai

# Ollama Configuration
ollama.base_url=http://localhost:11434
ollama.model=llama2

# RAG Configuration
rag.embedding_model=all-minilm-l6-v2
rag.vector_db_path=./data/vector_db
rag.index_path=./data/index

# Application Settings
app.log_level=INFO
app.data_dir=./data
```

## Принципы разработки

### SOLID

1. **Single Responsibility Principle (SRP)**: каждый класс должен иметь одну причину для изменения
2. **Open/Closed Principle (OCP)**: классы открыты для расширения, закрыты для модификации
3. **Liskov Substitution Principle (LSP)**: подклассы должны заменять базовые классы без нарушения функциональности
4. **Interface Segregation Principle (ISP)**: клиенты не должны зависеть от интерфейсов, которые не используют
5. **Dependency Inversion Principle (DIP)**: зависимости должны быть на абстракциях, а не на конкретных реализациях

### Clean Architecture

Структура проекта должна следовать принципам Clean Architecture:

```
project/
├── domain/              # Бизнес-логика, сущности, интерфейсы
│   ├── entities/       # Бизнес-сущности
│   ├── interfaces/     # Интерфейсы репозиториев и сервисов
│   └── use_cases/      # Сценарии использования
├── infrastructure/     # Внешние зависимости, реализации
│   ├── llm/           # Реализации LLM (VKAI и др.)
│   ├── tools/         # Реализации инструментов
│   ├── rag/           # RAG система
│   ├── git/           # Git интеграция
│   └── config/        # Конфигурация
├── application/        # Слой приложения
│   ├── cli/           # CLI интерфейс
│   ├── commands/      # Команды (/help, /search и т.д.)
│   └── services/      # Сервисы приложения
└── main.py            # Точка входа
```

**Правила зависимостей:**
- Внешние слои зависят от внутренних
- Внутренние слои не знают о внешних
- Зависимости направлены внутрь (к domain)

## Технические детали

### Зависимости

- Использовать современные Python библиотеки
- Для работы с Ollama: `ollama` или `langchain-ollama`
- Для векторных БД: `chromadb`, `faiss` или `qdrant`
- Для эмбеддингов: `sentence-transformers` или нативные модели Ollama
- Для работы с Git: `GitPython`
- Для CLI: `click`, `rich` или `typer`
- Для конфигурации: `pydantic-settings` или `python-dotenv`

### Обработка ошибок

- Использовать кастомные исключения для разных типов ошибок
- Логировать все ошибки с соответствующим уровнем
- Предоставлять понятные сообщения об ошибках пользователю

### Логирование

- Настроить структурированное логирование
- Разные уровни логирования для разных компонентов
- Возможность настройки через конфигурацию

## Чек-лист реализации

### Архитектура и структура
- [ ] Создана структура проекта согласно Clean Architecture
- [ ] Реализован базовый класс `LLM` с абстрактными методами
- [ ] Реализована конкретная реализация `VKAI`
- [ ] Создан базовый класс `Tool` с необходимыми полями и методами
- [ ] Все зависимости направлены внутрь (к domain слою)

### RAG-система
- [ ] Настроено подключение к Ollama
- [ ] Реализован индексатор для md-файлов
- [ ] Создана векторная база данных для эмбеддингов
- [ ] Реализован поисковый модуль
- [ ] Интегрирован RAG в основной поток работы агента

### CLI-приложение
- [ ] Реализован интерактивный CLI интерфейс
- [ ] Поддержка команд с префиксом `/`
- [ ] Красивый вывод результатов (rich/colorama)

### Команда /help
- [ ] Реализована команда `/help`
- [ ] Интеграция с RAG для поиска документации
- [ ] Поиск фрагментов кода по запросу
- [ ] Объяснение правил стиля кодирования

### Git инструменты
- [ ] `git_search_file` - поиск файла по названию
- [ ] `git_list_files` - список файлов
- [ ] `git_read_file` - чтение файла
- [ ] `git_current_branch` - текущая ветка
- [ ] `git_current_changes` - текущие изменения
- [ ] `git_diff` - diff файла/коммита
- [ ] `git_log` - история коммитов
- [ ] `git_file_history` - история файла
- [ ] Все инструменты зарегистрированы и доступны агенту

### Конфигурация
- [ ] Создан файл `local.properties`
- [ ] Создан `local.properties.example` с шаблоном
- [ ] Файл `local.properties` добавлен в `.gitignore`
- [ ] Реализован загрузчик конфигурации
- [ ] Валидация конфигурации при старте

### SOLID принципы
- [ ] Каждый класс имеет одну ответственность (SRP)
- [ ] Классы расширяемы без модификации (OCP)
- [ ] Подклассы корректно заменяют базовые (LSP)
- [ ] Интерфейсы сегрегированы (ISP)
- [ ] Зависимости на абстракциях (DIP)

### Качество кода
- [ ] Типизация (type hints) для всех функций и методов
- [ ] Docstrings для всех классов и методов
- [ ] Обработка ошибок с кастомными исключениями
- [ ] Настроено логирование
- [ ] Код следует PEP 8

### Тестирование и документация
- [ ] Базовые тесты для критичных компонентов
- [ ] README с инструкциями по установке и запуску
- [ ] Документация по архитектуре проекта
- [ ] Примеры использования команд

---

**Примечание**: При реализации каждого компонента следуй принципам Clean Architecture и SOLID. Все внешние зависимости должны быть инжектированы через интерфейсы, а не напрямую импортированы в бизнес-логику.
